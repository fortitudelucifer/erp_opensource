{#
  leaders.html - 部门负责人管理 / Department Leaders Management
  
  配置项目各部门的负责人：
  Configure department leaders for each project:
  
  Features / 功能:
  - 负责人列表 (部门、人员、职位) / Leaders list
  - 配置负责人表单 / Add leader form
  - 删除负责人 / Delete leader
  
  Dependencies / 依赖:
  - base.html (父模板 / Parent template)
  
  Variables / 传入变量:
  - contract: 合同对象 / Contract object
  - leaders: 负责人列表 / Leaders list
  - departments: 部门列表 / Department list
  - persons: 人员列表 / Person list
#}
{% extends 'base.html' %}

{% block title %}部门负责人 - {{ contract.project_code }}{% endblock %}

{% block content %}
<div class="glass-panel" style="padding: 24px; border-radius: 12px; margin-bottom: 24px;">
    {# 项目头部 / Project header #}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <div>
            <div style="font-size: 0.9rem; color: var(--color-text-sub);">项目编号: <span style="color: var(--color-primary); font-family: monospace;">{{ contract.project_code }}</span></div>
            <h2 style="margin: 4px 0 0 0; font-size: 1.5rem; font-weight: 700;">{{ contract.name }} - 部门负责人</h2>
        </div>
        <a href="{{ url_for('contracts.list_contracts') }}" class="btn-industrial" style="background: transparent; border: 1px solid rgba(255,255,255,0.2);">返回列表</a>
    </div>

    {# 功能标签页 / Tab navigation #}
    <div style="display: flex; gap: 8px; margin-bottom: 24px; overflow-x: auto; padding: 12px 4px 8px 4px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 5; margin-top: -12px;">
        <a href="{{ url_for('contracts.contract_overview', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">总览</a>
        <a href="{{ url_for('contracts.manage_tasks', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">任务/进度</a>
        <a href="{{ url_for('contracts.manage_sales', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">销售</a>
        <a href="{{ url_for('contracts.notify_contract', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">通知</a>
        <a href="{{ url_for('contracts.manage_leaders', contract_id=contract.id) }}" class="btn-industrial" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">负责人</a>
        <a href="{{ url_for('contracts.manage_procurements', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">采购</a>
        <a href="{{ url_for('contracts.manage_acceptances', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">验收</a>
        <a href="{{ url_for('contracts.manage_feedbacks', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">反馈</a>
        <a href="{{ url_for('contracts.manage_files', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">文件</a>
    </div>

    {# 双栏布局 / Two-column layout #}
    <div style="display: flex; flex-wrap: wrap; gap: 24px; align-items: flex-start;">
        {# 左栏：负责人列表 / Left: leaders list #}
        <div style="flex: 1; min-width: 0;">
            <h3 style="margin: 0 0 16px 0;">已配置的部门负责人</h3>
            
            {% if leaders %}
            <div class="table-container">
                <table class="ind-table">
                    <thead>
                        <tr>
                            <th style="width: 30%;">部门</th>
                            <th style="width: 30%;">负责人</th>
                            <th style="width: 25%;">职位</th>
                            <th style="width: 15%; text-align: right;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in leaders %}
                        <tr>
                            <td style="font-weight: 500;">{{ item.department.name }}</td>
                            <td>{{ item.person.name }}</td>
                            <td style="color: var(--color-text-sub);">{{ item.person.position }}</td>
                            <td style="text-align: center;">
                                <form method="post" action="{{ url_for('contracts.delete_leader', contract_id=contract.id, leader_id=item.id) }}" style="display:inline; margin:0;">
                                    <button type="submit" onclick="return confirm('确认删除该负责人？');" class="btn-text" style="color: var(--color-danger); background: transparent; border: none; cursor: pointer; font-size: 0.85rem;">
                                        删除
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="text-align: center; padding: 48px; color: var(--color-text-sub); border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px;">
                暂无配置，请在右侧添加。
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Add Form -->
        <div class="glass-panel" style="width: 350px; max-width: 100%; flex-shrink: 0; padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.2); height: fit-content;">
            <h3 style="margin: 0 0 16px 0;">配置负责人</h3>
            <form method="post">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">部门 <span style="color: var(--color-danger);">*</span></label>
                    <select name="department_id" class="form-control" style="width: 100%;" required>
                        <option value="">请选择部门</option>
                        {% for d in departments %}
                        <option value="{{ d.id }}">{{ d.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group" style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">负责人 <span style="color: var(--color-danger);">*</span></label>
                    <select name="person_id" class="form-control" style="width: 100%;" required>
                        <option value="">请选择人员</option>
                        {% for p in persons %}
                        <option value="{{ p.id }}">{{ p.name }} - {{ p.position }}</option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit" class="btn-industrial" style="width: 100%;">添加负责人</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

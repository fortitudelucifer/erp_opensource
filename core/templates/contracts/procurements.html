{#
  procurements.html - 采购清单管理 / Procurement List Management
  
  管理项目所需物料的采购跟踪：
  Manage procurement tracking for project materials:
  
  Features / 功能:
  - 采购项列表 (物料、数量、状态) / Procurement list
  - 新增采购项表单 / Add procurement form
  - 删除采购项 / Delete procurement item
  
  Procurement Status / 采购状态:
  - 未采购 / Not ordered
  - 已下单 / Ordered
  - 运输中 / In transit
  - 已到货 / Delivered
  
  Dependencies / 依赖:
  - base.html (父模板 / Parent template)
  
  Variables / 传入变量:
  - contract: 合同对象 / Contract object
  - items: 采购项列表 / Procurement items
#}
{% extends 'base.html' %}

{% block title %}采购清单 - {{ contract.project_code }}{% endblock %}

{% block content %}
<div class="glass-panel" style="padding: 24px; border-radius: 12px; margin-bottom: 24px;">
    {# 项目头部 / Project header #}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <div>
            <div style="font-size: 0.9rem; color: var(--color-text-sub);">项目编号: <span style="color: var(--color-primary); font-family: monospace;">{{ contract.project_code }}</span></div>
            <h2 style="margin: 4px 0 0 0; font-size: 1.5rem; font-weight: 700;">{{ contract.name }} - 采购清单</h2>
        </div>
        <a href="{{ url_for('contracts.list_contracts') }}" class="btn-industrial" style="background: transparent; border: 1px solid rgba(255,255,255,0.2);">返回列表</a>
    </div>

    {# 功能标签页 / Tab navigation #}
    <div style="display: flex; gap: 8px; margin-bottom: 24px; overflow-x: auto; padding: 12px 4px 8px 4px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 5; margin-top: -12px;">
        <a href="{{ url_for('contracts.contract_overview', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">总览</a>
        <a href="{{ url_for('contracts.manage_tasks', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">任务/进度</a>
        <a href="{{ url_for('contracts.manage_sales', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">销售</a>
        <a href="{{ url_for('contracts.notify_contract', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">通知</a>
        <a href="{{ url_for('contracts.manage_leaders', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">负责人</a>
        <a href="{{ url_for('contracts.manage_procurements', contract_id=contract.id) }}" class="btn-industrial" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">采购</a>
        <a href="{{ url_for('contracts.manage_acceptances', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">验收</a>
        <a href="{{ url_for('contracts.manage_feedbacks', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">反馈</a>
        <a href="{{ url_for('contracts.manage_files', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">文件</a>
    </div>

    {# 双栏布局 / Two-column layout #}
    <div style="display: grid; grid-template-columns: 1fr 350px; gap: 24px;">
        {# 左栏：采购项列表 / Left: procurement list #}
        <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">当前采购项目</h3>
                <div style="font-size: 0.85rem; color: var(--color-text-sub);">共 {{ items|length }} 项</div>
            </div>

            {% if items %}
            <div class="table-container">
                <table class="ind-table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">物料名称</th>
                            <th style="width: 15%;">数量 / 单位</th>
                            <th style="width: 15%;">预计到货</th>
                            <th style="width: 15%;">状态</th>
                            <th style="width: 20%;">备注</th>
                            <th style="width: 10%; text-align: right;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for it in items %}
                        <tr>
                            <td style="font-weight: 500;">{{ it.item_name }}</td>
                            <td>{{ it.quantity }} <span style="font-size: 0.8rem; color: var(--color-text-sub);">{{ it.unit }}</span></td>
                            <td>{{ it.expected_date or '-' }}</td>
                            <td>
                                <span class="status-badge">{{ it.status }}</span>
                            </td>
                            <td style="font-size: 0.85rem; color: var(--color-text-sub);">{{ it.remarks or '-' }}</td>
                            <td style="text-align: center;">
                                <form method="post" action="{{ url_for('contracts.delete_procurement', contract_id=contract.id, item_id=it.id) }}" style="display:inline; margin:0;">
                                    <button type="submit" onclick="return confirm('确认删除该采购项？');" class="btn-text" style="color: var(--color-danger); background: transparent; border: none; cursor: pointer; font-size: 0.85rem;">
                                        删除
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="text-align: center; padding: 48px; color: var(--color-text-sub); border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px;">
                暂无采购项，请在右侧添加。
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Add Form -->
        <div class="glass-panel" style="padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.2); height: fit-content;">
            <h3 style="margin: 0 0 16px 0;">新增采购项</h3>
            <form method="post">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">物料名称 <span style="color: var(--color-danger);">*</span></label>
                    <input type="text" name="item_name" class="form-control" style="width: 100%; box-sizing: border-box;" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="form-group">
                        <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">数量 <span style="color: var(--color-danger);">*</span></label>
                        <input type="number" name="quantity" class="form-control" style="width: 100%; box-sizing: border-box;" required>
                    </div>
                    <div class="form-group">
                        <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">单位</label>
                        <input type="text" name="unit" class="form-control" style="width: 100%; box-sizing: border-box;" placeholder="个/件/kg">
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">预计到货日期</label>
                    <input type="date" name="expected_date" class="form-control" style="width: 100%; box-sizing: border-box;">
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">状态</label>
                    <input type="text" name="status" class="form-control" style="width: 100%; box-sizing: border-box;" placeholder="如：未采购/已下单/运输中/已到货">
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">备注</label>
                    <textarea name="remarks" class="form-control" style="width: 100%; box-sizing: border-box;" rows="3"></textarea>
                </div>

                <button type="submit" class="btn-industrial" style="width: 100%;">保存采购项</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

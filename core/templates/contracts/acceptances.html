{#
  acceptances.html - 验收记录管理 / Acceptance Record Management
  
  管理项目各阶段的验收记录：
  Manage acceptance records for project stages:
  
  Features / 功能:
  - 验收列表 (阶段、负责人、日期、状态) / Acceptance list
  - 新增验收记录表单 / Add acceptance form
  - 删除验收记录 / Delete acceptance record
  
  Acceptance Status / 验收状态:
  - 进行中 (In Progress): 验收进行中
  - 通过 (Passed): 验收通过
  - 不通过 (Failed): 验收不通过
  
  Dependencies / 依赖:
  - base.html (父模板 / Parent template)
  
  Variables / 传入变量:
  - contract: 合同对象 / Contract object
  - records: 验收记录列表 / Acceptance records
  - persons: 人员列表 / Person list
#}
{% extends 'base.html' %}

{% block title %}验收记录 - {{ contract.project_code }}{% endblock %}

{% block content %}
<div class="glass-panel" style="padding: 24px; border-radius: 12px; margin-bottom: 24px;">
    {# 项目头部 / Project header #}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <div>
            <div style="font-size: 0.9rem; color: var(--color-text-sub);">项目编号: <span style="color: var(--color-primary); font-family: monospace;">{{ contract.project_code }}</span></div>
            <h2 style="margin: 4px 0 0 0; font-size: 1.5rem; font-weight: 700;">{{ contract.name }} - 验收记录</h2>
        </div>
        <a href="{{ url_for('contracts.list_contracts') }}" class="btn-industrial" style="background: transparent; border: 1px solid rgba(255,255,255,0.2);">返回列表</a>
    </div>

    {# 功能标签页 / Tab navigation #}
    <div style="display: flex; gap: 8px; margin-bottom: 24px; overflow-x: auto; padding: 12px 4px 8px 4px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 5; margin-top: -12px;">
        <a href="{{ url_for('contracts.contract_overview', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">总览</a>
        <a href="{{ url_for('contracts.manage_tasks', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">任务/进度</a>
        <a href="{{ url_for('contracts.manage_sales', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">销售</a>
        <a href="{{ url_for('contracts.notify_contract', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">通知</a>
        <a href="{{ url_for('contracts.manage_leaders', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">负责人</a>
        <a href="{{ url_for('contracts.manage_procurements', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">采购</a>
        <a href="{{ url_for('contracts.manage_acceptances', contract_id=contract.id) }}" class="btn-industrial" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">验收</a>
        <a href="{{ url_for('contracts.manage_feedbacks', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">反馈</a>
        <a href="{{ url_for('contracts.manage_files', contract_id=contract.id) }}" class="btn-industrial" style="background: transparent; border: none; color: var(--color-text-sub);">文件</a>
    </div>

    {# 双栏布局 / Two-column layout #}
    <div style="display: grid; grid-template-columns: 1fr 350px; gap: 24px;">
        {# 左栏：验收记录列表 / Left: acceptance list #}
        <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">已登记的验收</h3>
                <div style="font-size: 0.85rem; color: var(--color-text-sub);">共 {{ records|length }} 项</div>
            </div>

            {% if records %}
            <div class="table-container">
                <table class="ind-table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">阶段名称</th>
                            <th style="width: 20%;">验收负责人</th>
                            <th style="width: 15%;">日期</th>
                            <th style="width: 15%;">状态</th>
                            <th style="width: 15%;">备注</th>
                            <th style="width: 10%; text-align: right;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in records %}
                        <tr>
                            <td style="font-weight: 500;">{{ r.stage_name }}</td>
                            <td>{{ r.person.name if r.person else '-' }}</td>
                            <td>{{ r.date }}</td>
                            <td>
                                {% set status_class = 'status-badge' %}
                                {% if r.status == '通过' %}
                                    {% set status_class = 'status-badge accepted' %}
                                {% elif r.status == '不通过' %}
                                    {% set status_class = 'status-badge danger' %}
                                {% elif r.status == '进行中' %}
                                    {% set status_class = 'status-badge processing' %}
                                {% endif %}
                                <span class="{{ status_class }}">{{ r.status }}</span>
                            </td>
                            <td style="font-size: 0.85rem; color: var(--color-text-sub);">{{ r.remarks or '-' }}</td>
                            <td style="text-align: center;">
                                <form method="post" action="{{ url_for('contracts.delete_acceptance', contract_id=contract.id, acc_id=r.id) }}" style="display:inline; margin:0;">
                                    <button type="submit" onclick="return confirm('确认删除该验收记录？');" class="btn-text" style="color: var(--color-danger); background: transparent; border: none; cursor: pointer; font-size: 0.85rem;">
                                        删除
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="text-align: center; padding: 48px; color: var(--color-text-sub); border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px;">
                暂无验收记录，请在右侧添加。
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Add Form -->
        <div class="glass-panel" style="padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.2); height: fit-content;">
            <h3 style="margin: 0 0 16px 0;">新增验收记录</h3>
            <form method="post">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">阶段名称 <span style="color: var(--color-danger);">*</span></label>
                    <input type="text" name="stage_name" class="form-control" style="width: 100%; box-sizing: border-box;" placeholder="如：出厂验收 / 现场初验" required>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">验收负责人 (可选)</label>
                    <select name="person_id" class="form-control" style="width: 100%;">
                        <option value="">可不选</option>
                        {% for p in persons %}
                        <option value="{{ p.id }}">{{ p.name }} - {{ p.position }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">验收日期</label>
                    <input type="date" name="date" class="form-control" style="width: 100%; box-sizing: border-box;">
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">状态</label>
                    <select name="status" class="form-control" style="width: 100%;">
                        <option value="进行中">进行中</option>
                        <option value="通过">通过</option>
                        <option value="不通过">不通过</option>
                    </select>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 0.85rem; color: var(--color-text-sub); margin-bottom: 6px;">备注</label>
                    <textarea name="remarks" class="form-control" style="width: 100%; box-sizing: border-box;" rows="3"></textarea>
                </div>

                <button type="submit" class="btn-industrial" style="width: 100%;">保存验收记录</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
